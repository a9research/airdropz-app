# Airdropz 系统架构概述

## 项目简介

Airdropz 是一个基于 Electron + Next.js + Python 插件的跨平台桌面应用框架，专为自动化任务、数据采集和代理管理而设计。系统采用模块化架构，支持 JavaScript 和 Python 两种插件类型，提供强大的扩展能力。

## 核心特性

- 🖥️ **跨平台支持**：基于 Electron，支持 Windows、macOS、Linux
- ⚡ **现代前端**：使用 Next.js + React + TypeScript 构建用户界面
- 🔌 **插件系统**：支持 JavaScript 和 Python 两种插件类型
- 🕷️ **网页爬取**：集成 Crawlee + Playwright 进行智能网页抓取
- 💾 **本地存储**：使用 PouchDB 进行数据持久化
- 🌐 **代理管理**：内置代理池管理和轮换机制
- 🚀 **自动化构建**：GitHub Actions 自动打包和分发

## 系统架构

### 整体架构图

```
┌─────────────────────────────────────────────────────────────┐
│                    Airdropz 应用架构                        │
├─────────────────────────────────────────────────────────────┤
│  前端层 (Next.js + React)                                  │
│  ┌─────────────────┐  ┌─────────────────┐                  │
│  │  用户界面组件   │  │  插件管理界面   │                  │
│  └─────────────────┘  └─────────────────┘                  │
├─────────────────────────────────────────────────────────────┤
│  通信层 (IPC + Context Bridge)                             │
│  ┌─────────────────┐  ┌─────────────────┐                  │
│  │   Preload API   │  │   IPC Handlers  │                  │
│  └─────────────────┘  └─────────────────┘                  │
├─────────────────────────────────────────────────────────────┤
│  核心服务层 (Electron Main Process)                        │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐  │
│  │  插件管理器     │  │  浏览器服务     │  │  数据服务   │  │
│  │ PluginManager   │  │ BrowserService  │  │   PouchDB   │  │
│  └─────────────────┘  └─────────────────┘  └─────────────┘  │
├─────────────────────────────────────────────────────────────┤
│  插件层 (JavaScript + Python)                              │
│  ┌─────────────────┐  ┌─────────────────┐                  │
│  │  JS 插件        │  │  Python 插件    │                  │
│  │ proxy-browser   │  │ proxy-manager   │                  │
│  └─────────────────┘  └─────────────────┘                  │
├─────────────────────────────────────────────────────────────┤
│  外部服务层                                                 │
│  ┌─────────────────┐  ┌─────────────────┐                  │
│  │   代理服务      │  │   目标网站      │                  │
│  └─────────────────┘  └─────────────────┘                  │
└─────────────────────────────────────────────────────────────┘
```

### 核心组件

#### 1. 主进程 (Main Process)
- **文件**: `electron/main.js`
- **职责**: 
  - 应用生命周期管理
  - 窗口创建和管理
  - IPC 通信处理
  - 服务初始化

#### 2. 插件管理器 (Plugin Manager)
- **文件**: `electron/pluginManager.js`
- **职责**:
  - 插件发现和加载
  - JavaScript 插件管理
  - Python 插件进程管理
  - 插件生命周期控制

#### 3. 浏览器服务 (Browser Service)
- **文件**: `electron/browserService.js`
- **职责**:
  - 网页爬取服务
  - 代理池管理
  - Playwright 集成
  - 数据提取

#### 4. 预加载脚本 (Preload Script)
- **文件**: `electron/preload.js`
- **职责**:
  - 安全通信桥梁
  - API 暴露给渲染进程
  - 上下文隔离

#### 5. 前端应用 (Frontend)
- **目录**: `src/app/`
- **技术栈**: Next.js + React + TypeScript
- **职责**:
  - 用户界面
  - 用户交互
  - 数据展示

## 插件系统

### 插件类型

#### JavaScript 插件
- **位置**: `plugins/*/index.js`
- **配置**: `plugins/*/manifest.json`
- **特点**: 
  - 直接集成到主进程
  - 访问 Electron API
  - 高性能执行

#### Python 插件
- **位置**: `plugins/*/*.py`
- **配置**: `plugins/*/manifest.json`
- **特点**:
  - 独立进程运行
  - 丰富的第三方库
  - 跨语言通信

### 插件生命周期

```
1. 发现阶段
   ├── 扫描插件目录
   ├── 读取 manifest.json
   └── 验证插件格式

2. 初始化阶段
   ├── 加载插件代码
   ├── 注册插件动作
   └── 启动插件服务

3. 运行阶段
   ├── 处理插件请求
   ├── 执行插件逻辑
   └── 返回处理结果

4. 销毁阶段
   ├── 清理插件资源
   ├── 停止插件进程
   └── 注销插件动作
```

## 数据流

### 用户操作流程

```
用户操作 → 前端组件 → Preload API → IPC Handler → 核心服务 → 插件处理 → 外部服务
    ↓
数据返回 ← 前端展示 ← API 响应 ← IPC 响应 ← 服务结果 ← 插件结果 ← 外部响应
```

### 代理管理流程

```
1. 代理请求 → Python 代理管理器 → 代理池选择 → 代理配置
2. 网页请求 → 浏览器服务 → 代理配置 → 目标网站
3. 数据返回 → 爬取结果 → 数据处理 → 用户界面
```

## 技术栈

### 前端技术
- **Next.js 15.5.3**: React 框架
- **React 19.1.0**: UI 库
- **TypeScript 5**: 类型系统
- **Tailwind CSS 4**: 样式框架

### 后端技术
- **Electron 38.1.2**: 桌面应用框架
- **Node.js 20**: JavaScript 运行时
- **Python 3.13**: Python 运行时

### 数据存储
- **PouchDB 9.0.0**: 本地数据库
- **JSON**: 配置文件格式

### 网页爬取
- **Crawlee 3.15.0**: 爬虫框架
- **Playwright 1.55.0**: 浏览器自动化

### 构建工具
- **Electron Forge**: 应用打包
- **PyInstaller**: Python 插件打包
- **GitHub Actions**: 自动化构建

## 目录结构

```
framework/
├── electron/                 # Electron 主进程
│   ├── main.js              # 主进程入口
│   ├── pluginManager.js     # 插件管理器
│   ├── browserService.js    # 浏览器服务
│   └── preload.js           # 预加载脚本
├── src/                     # Next.js 前端源码
│   └── app/                 # Next.js 应用
├── plugins/                 # 插件目录
│   ├── proxy-browser/       # JS 代理浏览器插件
│   └── proxy-manager/       # Python 代理管理插件
├── public/                  # 静态资源
├── doc/                     # 文档目录
├── .github/workflows/       # GitHub Actions
└── package.json             # 项目配置
```

## 安全特性

- **上下文隔离**: 渲染进程与主进程隔离
- **禁用 Node 集成**: 渲染进程无法直接访问 Node.js
- **预加载脚本**: 安全的 API 暴露机制
- **插件沙箱**: Python 插件独立进程运行

## 性能优化

- **代码分割**: Next.js 自动代码分割
- **缓存机制**: npm 和构建缓存
- **并行构建**: 多平台并行打包
- **资源优化**: 静态资源压缩

## 扩展性

- **插件系统**: 支持热插拔插件
- **模块化设计**: 松耦合的组件架构
- **API 接口**: 标准化的插件接口
- **配置驱动**: 基于配置的灵活部署

这个架构设计确保了系统的可维护性、可扩展性和高性能，为开发者提供了强大的工具来构建复杂的桌面应用。
